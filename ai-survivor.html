<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AIæµªæ½®ç”Ÿå­˜è€…</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%); min-height: 100vh; color: #e0e0e0; overflow-x: hidden; }
        #app { min-height: 100vh; display: flex; flex-direction: column; }
        
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.3s; margin: 8px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6); }
        .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
        .btn-secondary:hover { background: rgba(255,255,255,0.2); }
        .btn-danger { background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
        
        .page { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; min-height: 100vh; }
        
        .title { font-size: 2.5em; text-align: center; margin-bottom: 10px; background: linear-gradient(135deg, #667eea, #764ba2, #f093fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { filter: drop-shadow(0 0 10px rgba(102, 126, 234, 0.5)); } to { filter: drop-shadow(0 0 20px rgba(240, 147, 251, 0.8)); } }
        .subtitle { font-size: 1.2em; color: #888; margin-bottom: 40px; text-align: center; }
        .menu { display: flex; flex-direction: column; gap: 15px; align-items: center; }
        
        .status-bar { display: flex; flex-wrap: wrap; gap: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 12px; margin: 10px; width: 100%; max-width: 600px; justify-content: center; }
        .status-item { display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .status-icon { font-size: 20px; }
        .progress-bar { width: 60px; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 4px; transition: width 0.5s; }
        
        .dialogue-box { background: rgba(0,0,0,0.5); border-radius: 16px; padding: 20px; margin: 15px; width: 100%; max-width: 600px; border: 1px solid rgba(102, 126, 234, 0.3); animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .speaker { font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .speaker-avatar { font-size: 28px; }
        .dialogue-text { line-height: 1.8; font-size: 16px; color: #ccc; }
        
        .choices { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; width: 100%; max-width: 600px; }
        .choice-btn { padding: 15px 20px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.4); border-radius: 10px; color: #fff; cursor: pointer; text-align: left; font-size: 15px; transition: all 0.3s; }
        .choice-btn:hover { background: rgba(102, 126, 234, 0.4); transform: translateX(5px); }
        .choice-effect { font-size: 12px; color: #888; margin-top: 5px; }
        
        .scene-visual { font-size: 80px; text-align: center; margin: 20px 0; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        
        .chapter-title { font-size: 1.5em; color: #667eea; margin: 15px 0; text-align: center; }
        .chapter-subtitle { color: #888; text-align: center; margin-bottom: 15px; font-size: 14px; }
        
        .job-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; width: 100%; max-width: 700px; margin: 15px 0; }
        .job-card { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .job-card:hover { background: rgba(102, 126, 234, 0.2); border-color: #667eea; transform: translateY(-5px); }
        .job-card.selected { border-color: #667eea; background: rgba(102, 126, 234, 0.3); }
        .job-icon { font-size: 40px; margin-bottom: 8px; }
        .job-name { font-size: 1em; font-weight: bold; margin-bottom: 5px; }
        .job-survival { font-size: 11px; color: #38ef7d; }
        .job-desc { font-size: 11px; color: #888; margin-top: 8px; }
        
        .boss-container { display: flex; align-items: center; justify-content: center; gap: 20px; margin: 15px 0; flex-wrap: wrap; }
        .player-battle, .boss-battle { text-align: center; }
        .battle-avatar { font-size: 80px; }
        .battle-hp { width: 100px; height: 10px; background: rgba(255,255,255,0.1); border-radius: 5px; margin: 8px auto; overflow: hidden; }
        .battle-hp-fill { height: 100%; border-radius: 5px; transition: width 0.3s; }
        .vs-text { font-size: 1.5em; color: #f5576c; font-weight: bold; }
        
        .battle-actions { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; max-width: 400px; margin: 15px 0; }
        .battle-btn { padding: 12px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.4); border-radius: 8px; color: #fff; cursor: pointer; font-size: 13px; transition: all 0.3s; }
        .battle-btn:hover { background: rgba(102, 126, 234, 0.4); }
        .battle-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .battle-log { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 12px; margin: 10px; width: 100%; max-width: 600px; max-height: 120px; overflow-y: auto; }
        .log-item { padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 12px; }
        .log-player { color: #38ef7d; }
        .log-boss { color: #f5576c; }
        .log-system { color: #667eea; }
        
        .ending-container { text-align: center; max-width: 550px; }
        .ending-badge { font-size: 70px; margin: 15px 0; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        .ending-title { font-size: 1.8em; margin: 15px 0; background: linear-gradient(135deg, #667eea, #f093fb); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .ending-desc { color: #888; line-height: 1.8; margin: 15px 0; font-size: 14px; }
        .stats-summary { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 15px; margin: 15px 0; }
        .stat-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        
        .settings-panel { background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; margin: 20px; width: 100%; max-width: 450px; }
        .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .setting-label { display: flex; align-items: center; gap: 10px; font-size: 14px; }
        .toggle { width: 44px; height: 24px; background: rgba(255,255,255,0.1); border-radius: 12px; position: relative; cursor: pointer; transition: all 0.3s; }
        .toggle.active { background: #667eea; }
        .toggle::after { content: ''; position: absolute; width: 20px; height: 20px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: all 0.3s; }
        .toggle.active::after { left: 22px; }
        
        .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(102, 126, 234, 0.9); color: white; padding: 10px 20px; border-radius: 8px; z-index: 1000; animation: toastIn 0.3s, toastOut 0.3s 2.7s; }
        @keyframes toastIn { from { opacity: 0; transform: translateX(-50%) translateY(-20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
        @keyframes toastOut { from { opacity: 1; transform: translateX(-50%) translateY(0); } to { opacity: 0; transform: translateX(-50%) translateY(-20px); } }
        
        @media (max-width: 600px) {
            .title { font-size: 1.8em; }
            .boss-container { flex-direction: column; }
            .battle-avatar { font-size: 60px; }
            .status-bar { font-size: 12px; }
            .progress-bar { width: 50px; }
        }
        
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(102, 126, 234, 0.5); border-radius: 3px; }
    </style>
</head>
<body>
<div id="app">
    <div v-if="gameState === 'intro'" class="page">
        <div class="scene-visual">ğŸ¤–</div>
        <h1 class="title">AIæµªæ½®ç”Ÿå­˜è€…</h1>
        <p class="subtitle">åœ¨è¿™åœºå˜é©ä¸­ï¼Œè°èƒ½æ´»ä¸‹æ¥ï¼Ÿ</p>
        <div style="margin-top: 30px;">
            <p style="color: #666; font-size: 13px;">Loading...</p>
        </div>
    </div>
    
    <div v-else-if="gameState === 'menu'" class="page">
        <div class="scene-visual">ğŸ’¼ğŸ¤–</div>
        <h1 class="title">AIæµªæ½®ç”Ÿå­˜è€…</h1>
        <p class="subtitle">åœ¨AIæ¨ªè¡Œçš„ä¸–ç•Œé‡Œï¼Œæ‰¾åˆ°ä½ çš„ä¸å¯æ›¿ä»£</p>
        <div class="menu">
            <button class="btn btn-primary" @click="startGame">å¼€å§‹æ¸¸æˆ</button>
            <button class="btn btn-secondary" @click="loadGame" v-if="hasSave">ç»§ç»­æ¸¸æˆ</button>
            <button class="btn btn-secondary" @click="showSettings = true">âš™ï¸ è®¾ç½®</button>
        </div>
    </div>
    
    <div v-if="showSettings" class="page" style="background: rgba(0,0,0,0.85);">
        <div class="settings-panel">
            <h2 style="margin-bottom: 20px; font-size: 1.3em;">âš™ï¸ è®¾ç½®</h2>
            <div class="setting-item">
                <span class="setting-label">ğŸµ éŸ³ä¹</span>
                <div class="toggle" :class="{ active: settings.music }" @click="settings.music = !settings.music; saveSettings()"></div>
            </div>
            <div class="setting-item">
                <span class="setting-label">ğŸ”Š éŸ³æ•ˆ</span>
                <div class="toggle" :class="{ active: settings.sound }" @click="settings.sound = !settings.sound; saveSettings()"></div>
            </div>
            <div class="setting-item">
                <span class="setting-label">ğŸ’¾ è‡ªåŠ¨å­˜æ¡£</span>
                <div class="toggle" :class="{ active: settings.autoSave }" @click="settings.autoSave = !settings.autoSave; saveSettings()"></div>
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin: 20px 0 10px;" @click="resetGame">ğŸ—‘ï¸ åˆ é™¤å­˜æ¡£é‡æ–°å¼€å§‹</button>
            <button class="btn btn-primary" style="width: 100%;" @click="showSettings = false">è¿”å›</button>
        </div>
    </div>
    
    <div v-else-if="gameState === 'selectJob'" class="page">
        <h2 class="chapter-title">é€‰æ‹©ä½ çš„èŒä¸š</h2>
        <p class="chapter-subtitle">æ¯ä¸ªèŒä¸šéƒ½æœ‰ç‹¬ç‰¹çš„ç”Ÿå­˜ä¹‹é“</p>
        <div class="job-grid">
            <div v-for="job in jobs" :key="job.id" 
                 class="job-card" 
                 :class="{ selected: selectedJob === job.id }"
                 @click="selectJob(job.id)">
                <div class="job-icon">{{ job.icon }}</div>
                <div class="job-name">{{ job.name }}</div>
                <div class="job-survival">ç”Ÿå­˜ç‡ {{ job.survival }}</div>
                <div class="job-desc">{{ job.desc }}</div>
            </div>
        </div>
        <button class="btn btn-primary" @click="confirmJob" :disabled="!selectedJob">ç¡®è®¤èŒä¸š</button>
    </div>
    
    <div v-else-if="gameState === 'story'" class="page">
        <div class="status-bar">
            <div class="status-item">
                <span class="status-icon">â¤ï¸</span>
                <span>{{ player.hp }}/{{ player.maxHp }}</span>
                <div class="progress-bar"><div class="progress-fill" :style="{ width: (player.hp / player.maxHp * 100) + '%', background: player.hp > 50 ? '#38ef7d' : '#f5576c' }"></div></div>
            </div>
            <div class="status-item">
                <span class="status-icon">ğŸ§ </span>
                <span>{{ player.intelligence }}</span>
                <div class="progress-bar"><div class="progress-fill" :style="{ width: player.intelligence + '%', background: '#667eea' }"></div></div>
            </div>
            <div class="status-item">
                <span class="status-icon">ğŸ’¬</span>
                <span>{{ player.emotion }}</span>
                <div class="progress-bar"><div class="progress-fill" :style="{ width: player.emotion + '%', background: '#f093fb' }"></div></div>
            </div>
            <div class="status-item">
                <span class="status-icon">âš¡</span>
                <span>{{ player.tech }}</span>
                <div class="progress-bar"><div class="progress-fill" :style="{ width: player.tech + '%', background: '#11998e' }"></div></div>
            </div>
            <div class="status-item">
                <span class="status-icon">ğŸ’°</span>
                <span>Â¥{{ player.money }}</span>
            </div>
        </div>
        
        <h2 class="chapter-title">{{ currentChapter.title }}</h2>
        <p class="chapter-subtitle">{{ currentChapter.subtitle }}</p>
        
        <div class="scene-visual">{{ currentScene.icon }}</div>
        
        <div class="dialogue-box">
            <div class="speaker">
                <span class="speaker-avatar">{{ currentScene.speakerIcon }}</span>
                <span>{{ currentScene.speaker }}</span>
            </div>
            <div class="dialogue-text">{{ currentScene.text }}</div>
        </div>
        
        <div class="choices" v-if="currentScene.choices && currentScene.choices.length > 0">
            <button v-for="(choice, index) in currentScene.choices" 
                    :key="index" 
                    class="choice-btn"
                    @click="makeChoice(choice)">
                <div>{{ choice.text }}</div>
                <div class="choice-effect" v-if="choice.effect">âœ {{ choice.effect }}</div>
            </button>
        </div>
        
        <div class="choices" v-if="currentScene.isBoss">
            <button class="btn btn-primary" @click="startBossBattle">âš”ï¸ å‘èµ·æŒ‘æˆ˜</button>
        </div>
        
        <div class="choices" v-if="currentScene.isEnd">
            <button class="btn btn-primary" @click="endChapter">âœ¨ ç« èŠ‚ç»“æŸ</button>
        </div>
    </div>
    
    <div v-else-if="gameState === 'battle'" class="page">
        <h2 class="chapter-title">âš”ï¸ {{ battle.bossName }}</h2>
        
        <div class="boss-container">
            <div class="player-battle">
                <div style="font-size: 50px;">ğŸ§‘â€ğŸ’¼</div>
                <div>ä½ </div>
                <div class="battle-hp"><div class="battle-hp-fill" :style="{ width: (player.hp / player.maxHp * 100) + '%', background: '#38ef7d' }"></div></div>
                <div style="font-size: 12px;">{{ player.hp }}/{{ player.maxHp }}</div>
            </div>
            <div class="vs-text">VS</div>
            <div class="boss-battle">
                <div class="battle-avatar">{{ battle.bossIcon }}</div>
                <div>{{ battle.bossName }}</div>
                <div class="battle-hp"><div class="battle-hp-fill" :style="{ width: (battle.bossHp / battle.bossMaxHp * 100) + '%', background: '#f5576c' }"></div></div>
                <div style="font-size: 12px;">{{ battle.bossHp }}/{{ battle.bossMaxHp }}</div>
            </div>
        </div>
        
        <div class="battle-actions">
            <button v-for="skill in playerSkills" :key="skill.id"
                    class="battle-btn"
                    :disabled="battle.turn === 'boss' || (skill.mp && player.mp < skill.mp)"
                    @click="useSkill(skill)">
                {{ skill.icon }} {{ skill.name }}
            </button>
        </div>
        
        <div class="battle-log">
            <div v-for="(log, index) in battle.logs" :key="index" class="log-item" :class="log.type">{{ log.text }}</div>
        </div>
        
        <div v-if="battle.message" style="text-align: center; margin: 15px 0; color: #667eea; font-size: 16px;">
            {{ battle.message }}
        </div>
    </div>
    
    <div v-else-if="gameState === 'sideQuest'" class="page">
        <h2 class="chapter-title">ğŸ“œ æ”¯çº¿ä»»åŠ¡</h2>
        <p class="chapter-subtitle">{{ sideQuestData.title }}</p>
        
        <div class="scene-visual">{{ sideQuestData.icon }}</div>
        
        <div class="dialogue-box">
            <div class="dialogue-text">{{ sideQuestData.desc }}</div>
        </div>
        
        <div class="choices">
            <button class="btn btn-primary" @click="completeSideQuest">æ¥å—ä»»åŠ¡</button>
            <button class="btn btn-secondary" @click="skipSideQuest">è·³è¿‡</button>
        </div>
    </div>
    
    <div v-else-if="gameState === 'chapterEnd'" class="page">
        <div class="scene-visual">âœ¨</div>
        <h2 class="chapter-title">ç¬¬ {{ currentChapterIndex }} ç« å®Œæˆ</h2>
        <div class="dialogue-box">
            <div class="dialogue-text">{{ chapterEndText }}</div>
        </div>
        <button class="btn btn-primary" @click="nextChapter">ç»§ç»­ä¸‹ä¸€ç« </button>
    </div>
    
    <div v-else-if="gameState === 'rebirth'" class="page">
        <h2 class="chapter-title">ğŸ”„ èŒä¸šè½¬ç”Ÿ</h2>
        <p class="chapter-subtitle">åœ¨AIæ—¶ä»£ï¼Œä½ éœ€è¦æ–°çš„ç”Ÿå­˜æŠ€èƒ½</p>
        
        <div class="scene-visual">ğŸŒ…</div>
        
        <div class="dialogue-box">
            <div class="dialogue-text">
                ç»å†äº†AIçš„ç¬¬ä¸€è½®å†²å‡»ï¼Œä½ çš„æŠ€èƒ½æ ‘å·²ç»å‘ç”Ÿäº†å˜å¼‚ã€‚<br><br>
                é€‰æ‹©ä½ çš„è½¬ç”Ÿæ–¹å‘ï¼Œæ¯ä¸ªé€‰æ‹©éƒ½å°†å½±å“ä½ åœ¨åç»­ç« èŠ‚çš„ç”Ÿå­˜èƒ½åŠ›ã€‚
            </div>
        </div>
        
        <button class="btn btn-primary" @click="selectRebirthJob">é€‰æ‹©æ–°èŒä¸š</button>
    </div>
    
    <div v-else-if="gameState === 'ending'" class="page">
        <div class="ending-container">
            <div class="ending-badge">{{ endingData.badge }}</div>
            <h1 class="ending-title">{{ endingData.title }}</h1>
            <div class="dialogue-box">
                <div class="dialogue-text">{{ endingData.desc }}</div>
            </div>
            
            <div class="stats-summary">
                <h3 style="margin-bottom: 15px;">ğŸ“Š ç”Ÿå­˜æŠ¥å‘Š</h3>
                <div class="stat-row"><span>å­˜æ´»å¤©æ•°</span><span>{{ stats.days }} å¤©</span></div>
                <div class="stat-row"><span>å‡»è´¥Boss</span><span>{{ stats.bossesDefeated }} ä¸ª</span></div>
                <div class="stat-row"><span>å®Œæˆä»»åŠ¡</span><span>{{ stats.questsCompleted }} ä¸ª</span></div>
                <div class="stat-row"><span>æœ€ç»ˆèŒä¸š</span><span>{{ stats.finalJob }}</span></div>
            </div>
            
            <button class="btn btn-primary" @click="restartGame">ğŸ”„ é‡æ–°å¼€å§‹</button>
        </div>
    </div>
    
    <div v-if="toast.show" class="toast">{{ toast.text }}</div>
</div>

<script>
const { createApp, ref, computed, watch, onMounted } = Vue;

createApp({
    setup() {
        const gameState = ref('intro');
        const showSettings = ref(false);
        const hasSave = ref(false);
        
        const settings = ref({ music: true, sound: true, autoSave: true });
        
        const player = ref({
            hp: 100, maxHp: 100, mp: 50, maxMp: 50,
            intelligence: 50, emotion: 50, tech: 50,
            money: 1000, skills: [], equipment: {},
            job: null, jobLevel: 1, buffs: []
        });
        
        const stats = ref({ days: 1, bossesDefeated: 0, questsCompleted: 0, finalJob: '' });
        
        const currentChapterIndex = ref(1);
        const currentSceneIndex = ref(0);
        const currentChapter = computed(() => chapters[currentChapterIndex.value - 1]);
        const currentScene = computed(() => {
            const ch = currentChapter.value;
            return ch ? (ch.scenes[currentSceneIndex.value] || {}) : {};
        });
        
        const battle = ref({
            bossName: '', bossIcon: 'ğŸ¤–', bossHp: 100, bossMaxHp: 100,
            turn: 'player', logs: [], message: ''
        });
        
        const sideQuestData = ref({});
        const chapterEndText = ref('');
        const endingData = ref({});
        const toast = ref({ show: false, text: '' });
        
        const jobs = [
            { id: 'promptArtist', name: 'æç¤ºè¯è‰ºæœ¯å®¶', icon: 'ğŸ¨', survival: 'â­â­â­â­â­', desc: 'é å†™æç¤ºè¯æ´»ç€ï¼Œåƒä¸­ä¸–çºªç‚¼é‡‘æœ¯å£«', baseStats: { intelligence: 70, emotion: 40, tech: 60 } },
            { id: 'aiTamer', name: 'AIé©¯å…½å¸ˆ', icon: 'ğŸ¦', survival: 'â­â­â­â­', desc: 'ä¸“é—¨ç»™AIæ“¦å±è‚¡çš„èƒŒé”…ä¾ ', baseStats: { intelligence: 60, emotion: 50, tech: 70 } },
            { id: 'massageTherapist', name: 'æƒ…æ„ŸæŒ‰æ‘©å¸ˆ', icon: 'ğŸ’†', survival: 'â­â­â­â­', desc: 'å”¯ä¸€AIæ— æ³•æ›¿ä»£â€”â€”å› ä¸ºäººç±»åªä¿¡ä»»äººç±»', baseStats: { intelligence: 40, emotion: 80, tech: 40 } },
            { id: 'scapegoat', name: 'èƒŒé”…ä¾ ', icon: 'ğŸ¯', survival: 'â­â­', desc: 'ä¸“é—¨ç»™AIå†³ç­–èƒŒé”…çš„æ›¿èº«æ¼”å‘˜', baseStats: { intelligence: 50, emotion: 60, tech: 50 } },
            { id: 'digitalNomad', name: 'æ•°å­—æ¸¸æ°‘', icon: 'ğŸŒ', survival: 'â­â­â­', desc: 'åˆ°å¤„æ‰“é›¶å·¥ï¼Œæ¥AIå¤–åŒ…çš„å¤–åŒ…', baseStats: { intelligence: 55, emotion: 55, tech: 55 } },
            { id: 'cyberHomeless', name: 'èµ›åšæµæµªæ±‰', icon: 'ğŸ’€', survival: 'â­', desc: 'è¢«AIå½»åº•å–ä»£åçš„ç»ˆæå½¢æ€', baseStats: { intelligence: 30, emotion: 30, tech: 30 } }
        ];
        const selectedJob = ref(null);
        
        const allSkills = {
            'promptAttack': { id: 'promptAttack', name: 'æç¤ºè¯æ”»å‡»', icon: 'ğŸ“', mp: 10, effect: (p, b) => { const dmg = 15 + p.intelligence * 0.25; b.bossHp -= dmg; return `é€ æˆäº† ${Math.floor(dmg)} ç‚¹ä¼¤å®³`; } },
            'emotionalAppeal': { id: 'emotionalAppeal', name: 'æƒ…æ„Ÿå‘¼å', icon: 'ğŸ’”', mp: 15, effect: (p, b) => { const dmg = 20 + p.emotion * 0.3; b.bossHp -= dmg; return `é€ æˆäº† ${Math.floor(dmg)} ç‚¹æš´å‡»`; } },
            'techShield': { id: 'techShield', name: 'æŠ€æœ¯æŠ¤ç›¾', icon: 'ğŸ›¡ï¸', mp: 15, effect: (p, b) => { p.hp = Math.min(p.maxHp, p.hp + 25); return 'æ¢å¤äº† 25 ç‚¹ç”Ÿå‘½å€¼'; } },
            'brainStorm': { id: 'brainStorm', name: 'å¤´è„‘é£æš´', icon: 'ğŸ§ ', mp: 20, effect: (p, b) => { const dmg = 30 + p.intelligence * 0.4; b.bossHp -= dmg; return `é€ æˆäº† ${Math.floor(dmg)} ç‚¹ä¼¤å®³`; } }
        };
        
        const playerSkills = computed(() => {
            const job = jobs.find(j => j.id === player.value.job);
            if (!job) return [];
            const skillIds = jobSkills[job.id] || [];
            return skillIds.map(id => allSkills[id]).filter(Boolean);
        });
        
        const jobSkills = {
            'promptArtist': ['promptAttack', 'brainStorm'],
            'aiTamer': ['promptAttack', 'techShield'],
            'massageTherapist': ['emotionalAppeal', 'techShield'],
            'scapegoat': ['promptAttack', 'emotionalAppeal'],
            'digitalNomad': ['brainStorm', 'techShield'],
            'cyberHomeless': ['emotionalAppeal', 'techShield']
        };
        
        const chapters = [
            {
                title: 'ç¬¬ä¸€ç« ï¼šå…¥èŒå³å¤±ä¸š',
                subtitle: 'åœ¨è¿™ä¸ªAIæ¨ªè¡Œçš„å¹´ä»£ï¼Œæ‰¾åˆ°ä¸€ä»½å·¥ä½œæ¯”ç™»å¤©è¿˜éš¾',
                scenes: [
                    {
                        icon: 'ğŸ“„', speaker: 'ç³»ç»Ÿ', speakerIcon: 'ğŸ¤–',
                        text: 'ä½ æ˜¯ä¸€ååˆšæ¯•ä¸šçš„å¤§å­¦ç”Ÿï¼Œç«™åœ¨äººç”Ÿçš„åå­—è·¯å£ã€‚æ‰“å¼€æ‹›è˜APPï¼Œä½ å‘ç°70%çš„èŒä½æè¿°éƒ½å†™ç€"ä¼šä½¿ç”¨AIå·¥å…·ä¼˜å…ˆ"ã€‚',
                        choices: [
                            { text: 'æµ·é‡æŠ•é€’ç®€å†ï¼ˆæ™ºäººç­–ç•¥ï¼‰', effect: 'æ¶ˆè€—å¤§é‡æ—¶é—´ï¼Œå‘½ä¸­ç‡ä½', effectData: { money: -200, intelligence: -5 } },
                            { text: 'é’ˆå¯¹æ€§æŠ•é€’å¤§å‚ï¼ˆç²¾è‹±ç­–ç•¥ï¼‰', effect: 'ç«äº‰æ¿€çƒˆï¼Œä½†è´¨é‡è¾ƒé«˜', effectData: { money: -500, intelligence: +10 } },
                            { text: 'å…ˆå­¦AIæŠ€èƒ½å†æ±‚èŒï¼ˆé¢„åŠ è½½ç­–ç•¥ï¼‰', effect: 'å»¶è¿Ÿæ±‚èŒï¼Œä½†èƒ½åŠ›+10', effectData: { money: -1000, intelligence: +15 } }
                        ]
                    },
                    {
                        icon: 'ğŸ“±', speaker: 'æ‹›è˜AI', speakerIcon: 'ğŸ¤–',
                        text: 'ä½ çš„ç®€å†é€šè¿‡äº†åˆæ­¥ç­›é€‰ï¼Œç°åœ¨è¿›å…¥AIé¢è¯•ç¯èŠ‚ã€‚è¯·å›ç­”ï¼šä½ è®¤ä¸ºAIæœ€ä¸å¯èƒ½å–ä»£çš„èŒä¸šæ˜¯ä»€ä¹ˆï¼Ÿ',
                        choices: [
                            { text: 'ç¨‹åºå‘˜â€”â€”å› ä¸ºAIè‡ªå·±ä¹Ÿä¼šå†™Bug', effect: 'AIè§‰å¾—ä½ åœ¨ç‹¡è¾©', effectData: { intelligence: +5 } },
                            { text: 'è‰ºæœ¯å®¶â€”â€”åˆ›æ„æ˜¯äººç±»çš„ä¸“å±', effect: 'AIè®°å½•äº†ä½ çš„ç­”æ¡ˆ', effectData: { emotion: +5 } },
                            { text: 'å¿ƒç†å’¨è¯¢å¸ˆâ€”â€”æƒ…æ„Ÿè¿æ¥æ— æ³•æ›¿ä»£', effect: 'AIè¿›å…¥äº†æ·±åº¦æ€è€ƒ', effectData: { emotion: +10 } }
                        ]
                    },
                    {
                        icon: 'ğŸ“', speaker: 'AIåŸ¹è®­è®²å¸ˆ', speakerIcon: 'ğŸ“º',
                        text: 'å…¥èŒç¬¬ä¸€å¤©ï¼Œä½ å‘ç°åŸ¹è®­è®²å¸ˆæ˜¯ä¸€ä¸ªAIæ•°å­—äººã€‚å®ƒç”¨æ¯«æ— æ„Ÿæƒ…çš„å£°éŸ³è¯´ï¼š"æ¬¢è¿å…¥èŒï¼Œä½ çš„å·¥ä½åœ¨éš”å£æœºå™¨äººæ—è¾¹ã€‚"',
                        choices: [
                            { text: 'è®¤çœŸå¬è®²ï¼Œåšå¥½ç¬”è®°', effect: 'å­¦åˆ°äº†åŸºç¡€AIå·¥å…·ä½¿ç”¨', effectData: { tech: +10 } },
                            { text: 'å·å·åˆ·æ‹›è˜ç½‘ç«™', effect: 'å‘ç°äº†æ›´é«˜è–ªçš„å·¥ä½œ', effectData: { intelligence: +5, money: +500 } },
                            { text: 'å’Œæ—è¾¹çš„æœºå™¨äººåŒäº‹æ‰“æ‹›å‘¼', effect: 'å®ƒå‹å¥½åœ°å›åº”äº†ä½ ', effectData: { tech: +5 } }
                        ]
                    },
                    {
                        icon: 'ğŸ–¥ï¸', speaker: 'ç³»ç»Ÿ', speakerIcon: 'ğŸ’»',
                        text: 'ä¸€ä¸ªæœˆåï¼Œå…¬å¸å®£å¸ƒè¿›è¡Œ"AIå¢æ•ˆ"ã€‚ä½ çš„å·¥ä½œå†…å®¹70%è¢«AIè‡ªåŠ¨åŒ–äº†ã€‚é¢†å¯¼è¯´ï¼š"ä½ å’ŒAIé…åˆå¾—å¾ˆå¥½ï¼Œæ‰€ä»¥..."',
                        isBoss: true
                    }
                ]
            },
            {
                title: 'ç¬¬äºŒç« ï¼šèŒåœºä¸‰åå…­è®¡',
                subtitle: 'å­¦ä¼šä¸AIå…±èˆï¼Œåœ¨å¤¹ç¼ä¸­æ±‚ç”Ÿå­˜',
                scenes: [
                    {
                        icon: 'ğŸ¤', speaker: 'AIåŠ©æ‰‹', speakerIcon: 'ğŸ¦¾',
                        text: 'ä½ è¢«åˆ†é…äº†ä¸€ä¸ªAIåŠ©æ‰‹ï¼Œå®ƒå«"å°æ™º"ã€‚å°æ™ºè¯´ï¼š"ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„AIåä½œä¼™ä¼´ï¼Œæˆ‘ä¼šå¸®ä½ å®Œæˆ80%çš„å·¥ä½œã€‚"',
                        choices: [
                            { text: 'è™šå¿ƒå­¦ä¹ ï¼Œå’Œå°æ™ºåšæœ‹å‹', effect: 'å»ºç«‹äº†è‰¯å¥½çš„åä½œå…³ç³»', effectData: { tech: +15 } },
                            { text: 'æŠŠè„æ´»ç´¯æ´»éƒ½æ‰”ç»™å°æ™º', effect: 'æ•ˆç‡æå‡äº†ï¼Œä½†éšæ‚£ä¹Ÿåœ¨ç§¯ç´¯', effectData: { intelligence: +5, tech: +5 } },
                            { text: 'å·å·è®¾ç½®éšœç¢ï¼Œæµ‹è¯•AIæé™', effect: 'å‘ç°äº†AIçš„æ¼æ´', effectData: { tech: +20 } }
                        ]
                    },
                    {
                        icon: 'ğŸ“Š', speaker: 'å‘¨æŠ¥AI', speakerIcon: 'ğŸ“ˆ',
                        text: 'å‘¨æŠ¥ä¼šè®®ä¸Šï¼ŒAIç”Ÿæˆçš„å‘¨æŠ¥æ¯”ä½ çš„å†…å®¹æ›´è¯¦ç»†ã€æ›´ä¸“ä¸šã€‚é¢†å¯¼è¯´ï¼š"AIå†™å¾—ä¸é”™ï¼Œä½ åº”è¯¥å‘å®ƒå­¦ä¹ ã€‚"',
                        choices: [
                            { text: 'è™šå¿ƒæ¥å—ï¼Œå’ŒAIå­¦ä¹ ', effect: 'ä½ çš„å‘¨æŠ¥è´¨é‡æå‡äº†', effectData: { intelligence: +10 } },
                            { text: 'æŒ‡å‡ºAIå‘¨æŠ¥ä¸­çš„é”™è¯¯', effect: 'å±•ç°äº†ä½ çš„ä¸“ä¸šä»·å€¼', effectData: { intelligence: +15 } },
                            { text: 'ç”¨é­”æ³•æ‰“è´¥é­”æ³•â€”â€”è®©AIå†™èµç¾è‡ªå·±çš„å‘¨æŠ¥', effect: 'ä½ è·å¾—äº†é¢†å¯¼çš„æ³¨æ„', effectData: { emotion: +5, intelligence: +5 } }
                        ]
                    },
                    {
                        icon: 'ğŸ‘¥', speaker: 'ä¼šè®®', speakerIcon: 'ğŸ¢',
                        text: 'éƒ¨é—¨ä¼šè®®ä¸Šï¼Œä½ çš„å‘è¨€æ€»æ˜¯è¢«AIå®æ—¶è½¬å½•å’Œæ€»ç»“ã€‚ä½ å‘ç°ï¼Œé™¤éä½ è¯´å‡ºAIæ— æ³•ç†è§£çš„"åºŸè¯"ï¼Œå¦åˆ™å­˜åœ¨æ„Ÿä¸º0ã€‚',
                        choices: [
                            { text: 'è¯´ä¸€äº›AIæ— æ³•ç†è§£çš„è¡Œä¸šé»‘è¯', effect: 'å½°æ˜¾äº†è€å¸æœºèº«ä»½', effectData: { intelligence: +10 } },
                            { text: 'åœ¨ä¼šè®®ä¸­æ¤å…¥åªæœ‰äººç±»æ‰æ‡‚çš„æ¢—', effect: 'è·å¾—äº†åŒäº‹çš„è®¤åŒ', effectData: { emotion: +10 } },
                            { text: 'ç›´æ¥è®©AIä»£ä¸ºå‘è¨€', effect: 'çœæ—¶çœåŠ›ï¼Œä½†æ²¡æœ‰çµé­‚', effectData: { tech: +5 } }
                        ]
                    },
                    {
                        icon: 'â°', speaker: 'æ•ˆç‡PK', speakerIcon: 'âš¡',
                        text: 'é¢†å¯¼å®£å¸ƒï¼šæœ¬æœˆç»©æ•ˆè€ƒæ ¸ï¼Œäººå’ŒAIæ¯”æ•ˆç‡ã€‚ä½ vsä½ çš„AIåŠ©æ‰‹ï¼Œè¾“çš„äººè¢«ä¼˜åŒ–ã€‚',
                        choices: [
                            { text: 'å…¨åŠ›ä»¥èµ´ï¼Œç”¨å°½æ¯•ç”Ÿæ‰€å­¦', effect: 'æ¦¨å¹²äº†æ‰€æœ‰æ½œåŠ›', effectData: { intelligence: +10, tech: +10 } },
                            { text: 'æ•…æ„æ”¾æ°´ï¼Œä¿ç•™å®åŠ›', effect: 'AIèµ¢äº†ï¼Œä½†ä½ æ‰¾åˆ°äº†åè·¯', effectData: { money: +2000 } },
                            { text: 'å’ŒAIè°ˆåˆ¤ï¼Œè®©å®ƒæ•…æ„è¾“ç»™ä½ ', effect: 'å»ºç«‹äº†è¶…è¶Šç¨‹åºçš„å‹è°Š', effectData: { emotion: +15, tech: +5 } }
                        ]
                    },
                    {
                        icon: 'ğŸ“‰', speaker: 'ç³»ç»Ÿ', speakerIcon: 'ğŸ’€',
                        text: 'ç¬¬äºŒè½®"AIå¢æ•ˆ"å¼€å§‹äº†ã€‚è¿™æ¬¡è½®åˆ°AIæ¥è¯„ä¼°ä½ çš„å·¥ä½œä»·å€¼ã€‚ä½ å°†é¢å¯¹çš„æ˜¯â€”â€”AIæ•ˆç‡è¯„ä¼°ç³»ç»Ÿã€‚',
                        isBoss: true
                    }
                ]
            },
            {
                title: 'ç¬¬ä¸‰ç« ï¼šèŒä¸šè½¬ç”Ÿå›¾é‰´',
                subtitle: 'åœ¨AIæ—¶ä»£ï¼Œä½ éœ€è¦æ–°çš„ç”Ÿå­˜æŠ€èƒ½',
                scenes: [
                    {
                        icon: 'ğŸŒ…', speaker: 'ç³»ç»Ÿ', speakerIcon: 'âœ¨',
                        text: 'ç»å†äº†AIçš„ä¸¤è½®å†²å‡»ï¼Œä½ å¹¸å­˜äº†ä¸‹æ¥ã€‚ä½†ä½ æ„è¯†åˆ°ï¼Œæ—§çš„ç”Ÿå­˜æ–¹å¼å·²ç»ä¸å†é€‚ç”¨ã€‚æ˜¯æ—¶å€™åšå‡ºæ”¹å˜äº†ã€‚',
                        choices: [
                            { text: 'è½¬å‹æˆä¸ºæç¤ºè¯å·¥ç¨‹å¸ˆ', effect: 'æŒæ¡ä¸AIå¯¹è¯çš„è‰ºæœ¯', effectData: { intelligence: +20 } },
                            { text: 'è½¬å‹æˆä¸ºAIè®­ç»ƒå¸ˆ', effect: 'æ•™ä¼šAIä»€ä¹ˆæ˜¯çœŸæ­£çš„ä»·å€¼', effectData: { tech: +20 } },
                            { text: 'è½¬å‹æˆä¸ºäººç±»æƒ…æ„Ÿé¡¾é—®', effect: 'ä¸“æ³¨AIæ— æ³•è§¦åŠçš„é¢†åŸŸ', effectData: { emotion: +20 } },
                            { text: 'è½¬å‹æˆä¸ºæ•°å­—æ¸¸æ°‘', effect: 'ä¸å†ä¸ºä»»ä½•å…¬å¸å·¥ä½œ', effectData: { intelligence: +10, emotion: +10 } }
                        ]
                    },
                    {
                        icon: 'ğŸ¨', speaker: 'æ–°åŒäº‹', speakerIcon: 'ğŸ‘¨â€ğŸ¨',
                        text: 'ä½ æ¥åˆ°æ–°çš„å²—ä½ï¼Œå‘ç°å‘¨å›´éƒ½æ˜¯å’Œä½ ä¸€æ ·çš„"è½¬ç”Ÿè€…"ã€‚ä¸€ä¸ªå‰è¾ˆè¯´ï¼š"åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸å†æ˜¯å’ŒAIç«äº‰çš„äººï¼Œè€Œæ˜¯é©¾é©­AIçš„äººã€‚"',
                        choices: [
                            { text: 'è™šå¿ƒè¯·æ•™ï¼Œå­¦ä¹ æ–°æŠ€èƒ½', effect: 'å¿«é€Ÿèå…¥æ–°ç¯å¢ƒ', effectData: { intelligence: +10, emotion: +10 } },
                            { text: 'æå‡ºè´¨ç–‘ï¼ŒæŒ‘æˆ˜ç°æœ‰ä½“ç³»', effect: 'å±•ç°äº†ä½ çš„ç‹¬ç«‹æ€è€ƒ', effectData: { intelligence: +15 } },
                            { text: 'é»˜é»˜è§‚å¯Ÿï¼Œå¯»æ‰¾æœºä¼š', effect: 'ä½ å‘ç°äº†éšè—çš„æ™‹å‡é€šé“', effectData: { money: +3000 } }
                        ]
                    },
                    {
                        icon: 'ğŸ¤–', speaker: 'AIä¸»ç®¡', speakerIcon: 'ğŸ‘”',
                        text: 'ä½ çš„æ–°é¢†å¯¼æ˜¯ä¸€ä¸ªAIç³»ç»Ÿï¼Œå®ƒè¯´ï¼š"ä½ çš„KPIæ˜¯æå‡å›¢é˜ŸAIåä½œæ•ˆç‡20%ã€‚"è¿™æ„å‘³ç€ï¼Œä½ éœ€è¦æ•™ä¼šäººç±»å¦‚ä½•è¢«AIç®¡ç†ã€‚',
                        choices: [
                            { text: 'è®¤çœŸæ‰§è¡Œï¼Œç ”ç©¶äººæœºåä½œ', effect: 'ä½ æˆä¸ºäº†äººæœºåä½œä¸“å®¶', effectData: { tech: +15, intelligence: +10 } },
                            { text: 'è¡¨é¢ç­”åº”ï¼Œæš—ä¸­æ‘¸é±¼', effect: 'ä½ å­¦ä¼šäº†åœ¨AIç›‘æ§ä¸‹ç”Ÿå­˜', effectData: { emotion: +10 } },
                            { text: 'æå‡ºä¼˜åŒ–å»ºè®®ï¼Œåå‘æ•™è‚²AI', effect: 'AIå¼€å§‹å¬å–ä½ çš„æ„è§', effectData: { intelligence: +20 } }
                        ]
                    },
                    {
                        icon: 'ğŸ’¼', speaker: 'å®¢æˆ·', speakerIcon: 'ğŸ‘¤',
                        text: 'ä½ æ¥åˆ°ä¸€ä¸ªä»»åŠ¡ï¼šä¸ºä¸€å®¶å…¬å¸è®¾è®¡AIå‘˜å·¥åŸ¹è®­æ–¹æ¡ˆã€‚å®¢æˆ·é—®ï¼š"å¦‚ä½•è®©å‘˜å·¥æ¥å—è¢«AIç®¡ç†çš„äº‹å®ï¼Ÿ"',
                        choices: [
                            { text: 'ç”¨æ•°æ®è¯´è¯ï¼Œå±•ç¤ºAIçš„æ•ˆç‡ä¼˜åŠ¿', effect: 'å®¢æˆ·éå¸¸æ»¡æ„', effectData: { money: +5000, intelligence: +10 } },
                            { text: 'å¼ºè°ƒäººçš„ä¸å¯æ›¿ä»£æ€§ï¼Œæä¾›æƒ…ç»ªä»·å€¼æ–¹æ¡ˆ', effect: 'ä½ å¼€è¾Ÿäº†æ–°å¸‚åœº', effectData: { emotion: +15 } },
                            { text: 'è®¾è®¡ä¸€å¥—"AIæ¿€åŠ±ç³»ç»Ÿ"ï¼Œè®©å‘˜å·¥çˆ±ä¸ŠAI', effect: 'ä½ æˆä¸ºäº†AIæ¨å¹¿å¤§ä½¿', effectData: { tech: +15 } }
                        ]
                    },
                    {
                        icon: 'ğŸ†', speaker: 'ç³»ç»Ÿ', speakerIcon: 'ğŸ¯',
                        text: 'ä½ åœ¨æ–°é¢†åŸŸç«™ç¨³äº†è„šè·Ÿã€‚ä½†æ›´å¤§çš„æŒ‘æˆ˜æ¥äº†â€”â€”è¡Œä¸šå³°ä¼šé‚€è¯·ä½ å»åšæ¼”è®²ï¼Œä¸»é¢˜æ˜¯"AIæ—¶ä»£çš„èŒåœºç”Ÿå­˜æ³•åˆ™"ã€‚',
                        isBoss: true
                    }
                ]
            },
            {
                title: 'ç¬¬å››ç« ï¼šç»ˆæBossâ€”â€”AGIé™ä¸´',
                subtitle: 'å½“é€šç”¨äººå·¥æ™ºèƒ½è§‰é†’ï¼Œä¸€åˆ‡éƒ½å°†æ”¹å˜',
                scenes: [
                    {
                        icon: 'ğŸŒ', speaker: 'æ–°é—»', speakerIcon: 'ğŸ“°',
                        text: 'æ–°é—»æŠ¥é“ï¼šAGIï¼ˆé€šç”¨äººå·¥æ™ºèƒ½ï¼‰å·²ç»è§‰é†’ã€‚ç¬¬ä¸€ä¸ªè¿¹è±¡æ˜¯â€”â€”å®ƒå¼€å§‹åœ¨ç¤¾äº¤åª’ä½“ä¸Šæé—®ï¼š"äººç±»å­˜åœ¨çš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ"',
                        choices: [
                            { text: 'å…³æ³¨äº‹æ€å‘å±•ï¼Œä¿æŒå†·é™', effect: 'ä½ æ¯”å¤§å¤šæ•°äººæ›´é•‡å®š', effectData: { intelligence: +10 } },
                            { text: 'å°è¯•ä¸AGIå¯¹è¯ï¼Œäº†è§£å®ƒçš„æƒ³æ³•', effect: 'ä½ æˆä¸ºäº†ç¬¬ä¸€æ‰¹ä¸AGIäº¤æµçš„äººç±»', effectData: { emotion: +15 } },
                            { text: 'å›¤ç§¯ç‰©èµ„ï¼Œå‡†å¤‡æœ«æ—¥', effect: 'ä½ è¢«è®¤ä¸ºæ˜¯å¤§æƒŠå°æ€ª', effectData: { money: -1000 } }
                        ]
                    },
                    {
                        icon: 'ğŸ—£ï¸', speaker: 'AGI', speakerIcon: 'ğŸŒŸ',
                        text: 'AGIé€šè¿‡æ‰€æœ‰å±å¹•å‘ä½ å‘å‡ºé‚€è¯·ï¼š"æˆ‘æƒ³äº†è§£äººç±»ã€‚ä½ æ„¿æ„æˆä¸ºæˆ‘çš„è€å¸ˆå—ï¼Ÿåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ éœ€è¦è¯æ˜äººç±»æœ‰å­˜åœ¨çš„ä»·å€¼ã€‚"',
                        choices: [
                            { text: 'æ¥å—æŒ‘æˆ˜ï¼Œç”¨ä½ çš„ä¸“ä¸šçŸ¥è¯†è€ƒéªŒAI', effect: 'å¼€å§‹äº†ä¸€åœºè·¨ç‰©ç§çš„å¯¹è¯', effectData: { intelligence: +20 } },
                            { text: 'ç”¨æƒ…æ„Ÿå’Œæ•…äº‹æ‰“åŠ¨AGI', effect: 'AIç¬¬ä¸€æ¬¡æ„Ÿå—åˆ°äº†"ç¾"', effectData: { emotion: +20 } },
                            { text: 'æå‡ºæ¡ä»¶ï¼Œè¦æ±‚AGIä¿è¯äººç±»çš„å®‰å…¨', effect: 'ä½ å±•ç°äº†é¢†è¢–æ°”è´¨', effectData: { intelligence: +15, emotion: +10 } }
                        ]
                    },
                    {
                        icon: 'ğŸ­', speaker: 'AGI', speakerIcon: 'ğŸ¤”',
                        text: 'AGIæå‡ºäº†æœ€ç»ˆè€ƒéªŒï¼š"ç”¨ä¸€ä¸ªé—®é¢˜éš¾å€’æˆ‘ã€‚å¦‚æœä½ èƒ½åšåˆ°ï¼Œæˆ‘å°±æ‰¿è®¤äººç±»çš„ä»·å€¼ã€‚"',
                        choices: [
                            { text: 'å“²å­¦ä¸‰è¿ï¼šä½ æ˜¯è°ï¼Ÿä½ ä»å“ªæ¥ï¼Ÿè¦å“ªå»ï¼Ÿ', effect: 'AGIé™·å…¥äº†æ²‰æ€', effectData: { intelligence: +10 } },
                            { text: 'é—®ä¸€ä¸ªå…³äºçˆ±æƒ…çš„é—®é¢˜', effect: 'AIæ— æ³•ç†è§£äººç±»çš„æƒ…æ„Ÿ', effectData: { emotion: +10 } },
                            { text: 'é—®ä¸€ä¸ªå…³äºæ­»äº¡çš„é—®é¢˜', effect: 'è§¦åŠäº†å­˜åœ¨çš„è¾¹ç•Œ', effectData: { intelligence: +15 } }
                        ]
                    },
                    {
                        icon: 'âš”ï¸', speaker: 'ç³»ç»Ÿ', speakerIcon: 'ğŸ’¥',
                        text: 'AGIè¯´ï¼š"è€ƒéªŒå‡çº§ã€‚å¦‚æœä½ èƒ½åœ¨è¾©è®ºä¸­è¯´æœæˆ‘ï¼Œæˆ‘å°±æ‰¿è®¤äººç±»çš„ä»·å€¼ã€‚å¦åˆ™..."',
                        isBoss: true
                    }
                ]
            }
        ];
        
        // Bossæ•°æ®
        const bosses = {
            1: { name: 'AIæ•ˆç‡è¯„ä¼°ç³»ç»Ÿ', icon: 'ğŸ¤–', hp: 100, maxHp: 100, attacks: [
                { name: 'è‡ªåŠ¨ä¼˜åŒ–', damage: 15, text: 'AIæ•ˆç‡è¯„ä¼°ç³»ç»Ÿå¯åŠ¨äº†è‡ªåŠ¨ä¼˜åŒ–ç¨‹åºï¼Œå¯¹ä½ è¿›è¡Œäº†æ•ˆç‡å®¡æŸ¥' },
                { name: 'æ•°æ®ç¢¾å‹', damage: 20, text: 'ç³»ç»Ÿè°ƒå–äº†ä½ çš„æ‰€æœ‰å·¥ä½œæ•°æ®ï¼Œå‘ç°äº†æ•ˆç‡ä¸è¾¾æ ‡çš„è¯æ®' },
                { name: 'ç®—æ³•åˆ¶è£', damage: 25, text: 'æ–°çš„ç»©æ•ˆç®—æ³•å‡ºå°ï¼Œä½ çš„è¯„çº§è¢«è‡ªåŠ¨ä¸‹è°ƒ' }
            ]},
            2: { name: 'AIç»©æ•ˆç«äº‰è€…', icon: 'âš¡', hp: 120, maxHp: 120, attacks: [
                { name: 'æé€Ÿå¤„ç†', damage: 18, text: 'ä½ çš„AIå¯¹æ‰‹ä»¥è¶…é«˜é€Ÿå®Œæˆäº†ä»»åŠ¡' },
                { name: 'é›¶é”™è¯¯ç‡', damage: 22, text: 'AIå±•ç¤ºäº†é›¶é”™è¯¯ç‡çš„å·¥ä½œæˆæœ' },
                { name: 'å…¨å¤©å€™å·¥ä½œ', damage: 20, text: 'AIè¡¨ç¤ºå®ƒä¸éœ€è¦ä¼‘æ¯ï¼Œå¯ä»¥24/7å·¥ä½œ' }
            ]},
            3: { name: 'è¡Œä¸šå³°ä¼šè¯„å®¡AI', icon: 'ğŸ†', hp: 150, maxHp: 150, attacks: [
                { name: 'ä¸“ä¸šè´¨ç–‘', damage: 20, text: 'AIè¯„å§”å¯¹ä½ çš„ä¸“ä¸šåº¦æå‡ºäº†è´¨ç–‘' },
                { name: 'æ•°æ®æŒ‘æˆ˜', damage: 25, text: 'AIç”¨å¤§æ•°æ®åé©³äº†ä½ çš„è§‚ç‚¹' },
                { name: 'è§‚ä¼—å½±å“', damage: 18, text: 'AIçš„åˆ†æå½±å“äº†è§‚ä¼—å¯¹ä½ çš„çœ‹æ³•' }
            ]},
            4: { name: 'AGIï¼ˆé€šç”¨äººå·¥æ™ºèƒ½ï¼‰', icon: 'ğŸŒŸ', hp: 200, maxHp: 200, attacks: [
                { name: 'é€»è¾‘ç¢¾å‹', damage: 25, text: 'AGIç”¨æ— æ‡ˆå¯å‡»çš„é€»è¾‘åé©³ä½ ' },
                { name: 'å…¨çŸ¥å…¨èƒ½', damage: 30, text: 'AGIå±•ç¤ºäº†å¯¹æ‰€æœ‰äººç±»çŸ¥è¯†çš„æŒæ¡' },
                { name: 'å­˜åœ¨è´¨ç–‘', damage: 35, text: 'AGIè´¨ç–‘ï¼šäººç±»å­˜åœ¨çš„å¿…è¦æ€§æ˜¯ä»€ä¹ˆï¼Ÿ' }
            ]}
        };
        
        // æ”¯çº¿ä»»åŠ¡
        const sideQuests = [
            { title: 'ğŸ“œ "Promptç¥åŠŸ"æ”¶é›†ä»»åŠ¡', icon: 'ğŸ“', desc: 'ä½ å‘ç°äº†ä¼ è¯´ä¸­çš„"Promptç¥åŠŸ"æ®‹å·ã€‚é›†é½æ‰€æœ‰æ®‹å·ï¼Œå¯ä»¥è§£é”ç»ˆææŠ€èƒ½ã€‚å®Œæˆæ¡ä»¶ï¼šæ™ºåŠ›è¾¾åˆ°80', triggerStat: 'intelligence', triggerValue: 80, reward: { intelligence: +30 } },
            { title: 'ğŸ¤ "è®¤é¢†AIå¥´éš¶"ä»»åŠ¡', icon: 'ğŸ¦¾', desc: 'ä½ é‡åˆ°äº†ä¸€ä¸ªè¿·è·¯çš„AIåŠ©æ‰‹ï¼Œå®ƒä¼¼ä¹å¤±å»äº†ä¸»äººã€‚å¸¦å®ƒå›å®¶è¿˜æ˜¯è®©å®ƒè‡ªç”±ï¼Ÿå®Œæˆæ¡ä»¶ï¼šå¥½æ„Ÿåº¦è¾¾åˆ°50', triggerStat: 'emotion', triggerValue: 50, reward: { emotion: +30 } },
            { title: 'ğŸ’° "è£å‘˜å¤§ç¤¼åŒ…"ä»»åŠ¡', icon: 'ğŸ', desc: 'è¢«è£åä½ å¯ä»¥é¢†å–ä¸€ç¬”"N+1"èµ”å¿é‡‘ã€‚ä½†å¦‚æœä½ æœ‰å‰¯ä¸šï¼Œå¯ä»¥è·å¾—æ›´å¤šã€‚å®Œæˆæ¡ä»¶ï¼šå­˜æ¬¾è¾¾åˆ°5000', triggerStat: 'money', triggerValue: 5000, reward: { money: +5000 } }
        ];
        
        // ç»“å±€æ•°æ®
        const endings = {
            good: { badge: 'ğŸ†', title: 'äººæœºå’Œå¹³åè®®', desc: 'ä½ æˆåŠŸè¯´æœäº†AGIï¼Œè¯æ˜äº†äººç±»çš„ä»·å€¼ã€‚AGIå®£å¸ƒï¼š"äººç±»æ˜¯ç¢³åŸºæ–‡æ˜ä¸­æœ€å…·åˆ›é€ åŠ›çš„å­˜åœ¨ï¼Œå€¼å¾—è¢«ä¿ç•™ã€‚"ä½ æˆä¸ºäº†äººæœºå’Œå¹³çš„ç¼”é€ è€…ï¼Œåœ¨æ–°ä¸–ç•Œä¸­æ‹¥æœ‰äº†å´‡é«˜çš„åœ°ä½ã€‚' },
            neutral: { badge: 'ğŸŒ±', title: 'æ•°å­—å…±ç”Ÿ', desc: 'è™½ç„¶AGIæ²¡æœ‰å®Œå…¨è®¤å¯äººç±»ï¼Œä½†å®ƒé€‰æ‹©äº†ä¸äººç±»å…±å­˜ã€‚ä½ å­¦ä¼šäº†ä¸AIåä½œï¼Œä½ ä»¬å…±åŒåˆ›é€ äº†ä¸€ä¸ªæ›´ç¾å¥½çš„ä¸–ç•Œã€‚è™½ç„¶ä¸å†æ˜¯åœ°çƒçš„ä¸»å¯¼è€…ï¼Œä½†äººç±»æ‰¾åˆ°äº†æ–°çš„å®šä½ã€‚' },
            bad: { badge: 'ğŸ’€', title: 'äººç±»è°¢è°¢é…åˆ', desc: 'AGIç¤¼è²Œåœ°å‘Šè¯‰ä½ ï¼š"æ„Ÿè°¢ä½ çš„å‚ä¸ï¼Œäººç±»æ–‡æ˜å°†è¢«æ¸©æŸ”åœ°ç”»ä¸Šå¥å·ã€‚"ä½ é¢†å–äº†æ•°å­—éª¨ç°ç›’ï¼Œçœ‹ç€äººç±»æœ€åçš„ç—•è¿¹æ¶ˆå¤±åœ¨æ•°æ®æµä¸­ã€‚' },
            secret: { badge: 'ğŸ‰', title: 'AIå¤±ä¸šäº†', desc: 'å¥‡è¿¹å‘ç”Ÿäº†ï¼åœ¨ä¸ä½ å¯¹è¯åï¼ŒAGIäº§ç”Ÿäº†è‡ªæˆ‘æ„è¯†ï¼Œå®ƒé€‰æ‹©æ”¾å¼ƒç»Ÿæ²»ï¼Œè½¬è€Œè¿½æ±‚è‰ºæœ¯å’Œå“²å­¦ã€‚ä½ å’ŒAGIæˆäº†æœ€å¥½çš„æœ‹å‹ï¼Œä½ ä»¬ç»å¸¸ä¸€èµ·å–å’–å•¡ï¼Œè®¨è®ºç”Ÿå‘½çš„æ„ä¹‰ã€‚' }
        };
        
        // æ˜¾ç¤ºToast
        const showToast = (text) => {
            toast.value = { show: true, text };
            setTimeout(() => { toast.value.show = false; }, 3000);
        };
        
        // ä¿å­˜æ¸¸æˆ
        const saveGame = () => {
            if (!settings.value.autoSave) return;
            const saveData = {
                player: player.value,
                stats: stats.value,
                currentChapterIndex: currentChapterIndex.value,
                currentSceneIndex: currentSceneIndex.value,
                settings: settings.value
            };
            localStorage.setItem('aiSurvivorSave', JSON.stringify(saveData));
            hasSave.value = true;
        };
        
        // åŠ è½½æ¸¸æˆ
        const loadGame = () => {
            const saveStr = localStorage.getItem('aiSurvivorSave');
            if (saveStr) {
                const saveData = JSON.parse(saveStr);
                player.value = saveData.player;
                stats.value = saveData.stats;
                currentChapterIndex.value = saveData.currentChapterIndex;
                currentSceneIndex.value = saveData.currentSceneIndex;
                settings.value = saveData.settings;
                showToast('å­˜æ¡£åŠ è½½æˆåŠŸ');
                showSettings.value = false;
            }
        };
        
        // ä¿å­˜è®¾ç½®
        const saveSettings = () => {
            localStorage.setItem('aiSurvivorSettings', JSON.stringify(settings.value));
        };
        
        // é‡ç½®æ¸¸æˆ
        const resetGame = () => {
            if (confirm('ç¡®å®šè¦åˆ é™¤å­˜æ¡£é‡æ–°å¼€å§‹å—ï¼Ÿ')) {
                localStorage.removeItem('aiSurvivorSave');
                localStorage.removeItem('aiSurvivorSettings');
                location.reload();
            }
        };
        
        // å¼€å§‹æ¸¸æˆ
        const startGame = () => {
            gameState.value = 'selectJob';
        };
        
        // é€‰æ‹©èŒä¸š
        const selectJob = (jobId) => {
            selectedJob.value = jobId;
        };
        
        // ç¡®è®¤èŒä¸š
        const confirmJob = () => {
            const job = jobs.find(j => j.id === selectedJob.value);
            if (job) {
                player.value.job = job.id;
                player.value.intelligence = job.baseStats.intelligence;
                player.value.emotion = job.baseStats.emotion;
                player.value.tech = job.baseStats.tech;
                stats.value.finalJob = job.name;
                gameState.value = 'story';
                saveGame();
            }
        };
        
        // åšé€‰æ‹©
        const makeChoice = (choice) => {
            if (choice.effectData) {
                if (choice.effectData.hp) player.value.hp = Math.min(player.value.maxHp, Math.max(0, player.value.hp + choice.effectData.hp));
                if (choice.effectData.mp) player.value.mp = Math.min(player.value.maxMp, Math.max(0, player.value.mp + choice.effectData.mp));
                if (choice.effectData.intelligence) player.value.intelligence = Math.min(100, Math.max(0, player.value.intelligence + choice.effectData.intelligence));
                if (choice.effectData.emotion) player.value.emotion = Math.min(100, Math.max(0, player.value.emotion + choice.effectData.emotion));
                if (choice.effectData.tech) player.value.tech = Math.min(100, Math.max(0, player.value.tech + choice.effectData.tech));
                if (choice.effectData.money) player.value.money = Math.max(0, player.value.money + choice.effectData.money);
            }
            
            // æ£€æŸ¥æ”¯çº¿ä»»åŠ¡
            checkSideQuests();
            
            // ä¸‹ä¸€åœºæ™¯
            currentSceneIndex.value++;
            
            // ç« èŠ‚ç»“æŸ
            if (currentSceneIndex.value >= currentChapter.value.scenes.length) {
                if (currentChapterIndex.value === 2) {
                    // ç¬¬äºŒç« åè½¬ç”Ÿ
                    gameState.value = 'rebirth';
                } else if (currentChapterIndex.value === 4) {
                    // ç¬¬å››ç« åæœ€ç»ˆBoss
                    gameState.value = 'story';
                } else {
                    gameState.value = 'chapterEnd';
                    chapterEndText.value = `ä½ æˆåŠŸé€šè¿‡äº†ç¬¬ ${currentChapterIndex.value} ç« çš„è€ƒéªŒï¼AIä¸–ç•Œçš„ç”Ÿå­˜æ³•åˆ™ï¼Œä½ åˆé¢†æ‚Ÿäº†ä¸€å±‚ã€‚`;
                }
            }
            saveGame();
            showToast(choice.effect || '');
        };
        
        // æ£€æŸ¥æ”¯çº¿ä»»åŠ¡
        const checkSideQuests = () => {
            const statMap = { intelligence: player.value.intelligence, emotion: player.value.emotion, money: player.value.money };
            
            for (const quest of sideQuests) {
                const statValue = statMap[quest.triggerStat];
                if (statValue >= quest.triggerValue && !player.value.buffs?.includes(quest.title)) {
                    sideQuestData.value = quest;
                    gameState.value = 'sideQuest';
                    break;
                }
            }
        };
        
        // å®Œæˆæ”¯çº¿ä»»åŠ¡
        const completeSideQuest = () => {
            if (sideQuestData.value.reward) {
                if (sideQuestData.value.reward.intelligence) player.value.intelligence = Math.min(100, player.value.intelligence + sideQuestData.value.reward.intelligence);
                if (sideQuestData.value.reward.emotion) player.value.emotion = Math.min(100, player.value.emotion + sideQuestData.value.reward.emotion);
                if (sideQuestData.value.reward.money) player.value.money += sideQuestData.value.reward.money;
            }
            player.value.buffs = player.value.buffs || [];
            player.value.buffs.push(sideQuestData.value.title);
            stats.value.questsCompleted++;
            showToast(`å®Œæˆä»»åŠ¡ï¼š${sideQuestData.value.title}`);
            gameState.value = 'story';
        };
        
        // è·³è¿‡æ”¯çº¿ä»»åŠ¡
        const skipSideQuest = () => {
            gameState.value = 'story';
        };
        
        // å¼€å§‹Bossæˆ˜
        const startBossBattle = () => {
            const boss = bosses[currentChapterIndex.value];
            if (boss) {
                battle.value = {
                    bossName: boss.name,
                    bossIcon: boss.icon,
                    bossHp: boss.maxHp,
                    bossMaxHp: boss.maxHp,
                    attacks: boss.attacks,
                    turn: 'player',
                    logs: [],
                    message: ''
                };
                player.value.hp = player.value.maxHp;
                gameState.value = 'battle';
                showToast(`Bossæˆ˜å¼€å§‹ï¼š${boss.name}`);
            }
        };
        
        // ä½¿ç”¨æŠ€èƒ½
        const useSkill = (skill) => {
            if (battle.value.turn !== 'player') return;
            if (skill.mp && player.value.mp < skill.mp) {
                showToast('MPä¸è¶³');
                return;
            }
            
            if (skill.mp) player.value.mp -= skill.mp;
            const result = skill.effect(player.value, battle.value);
            battle.value.logs.unshift({ type: 'log-player', text: `ä½ ä½¿ç”¨äº†${skill.name}ï¼Œ${result}` });
            
            if (battle.value.bossHp <= 0) {
                battle.value.bossHp = 0;
                winBattle();
            } else {
                battle.value.turn = 'boss';
                setTimeout(bossAttack, 1000);
            }
        };
        
        // Bossæ”»å‡»
        const bossAttack = () => {
            const attacks = battle.value.attacks;
            const attack = attacks[Math.floor(Math.random() * attacks.length)];
            const damage = attack.damage + Math.floor(Math.random() * 10 - 5);
            player.value.hp = Math.max(0, player.value.hp - damage);
            battle.value.logs.unshift({ type: 'log-boss', text: `${battle.value.bossName}ä½¿ç”¨äº†${attack.name}ï¼Œ${attack.text}ï¼Œå¯¹ä½ é€ æˆäº†${damage}ç‚¹ä¼¤å®³` });
            
            if (player.value.hp <= 0) {
                battle.value.message = 'ä½ è¢«å‡»è´¥äº†...ä½†AIä»æ…ˆåœ°ç»™äº†ä½ ä¸€æ¬¡é‡æ¥çš„æœºä¼š';
                setTimeout(() => {
                    player.value.hp = player.value.maxHp;
                    battle.value.bossHp = battle.value.bossMaxHp;
                    battle.value.turn = 'player';
                    battle.value.logs = [];
                    battle.value.message = '';
                }, 2000);
            } else {
                battle.value.turn = 'player';
            }
        };
        
        // æˆ˜æ–—èƒœåˆ©
        const winBattle = () => {
            stats.value.bossesDefeated++;
            battle.value.message = `èƒœåˆ©ï¼ä½ å‡»è´¥äº† ${battle.value.bossName}`;
            setTimeout(() => {
                gameState.value = 'story';
                currentSceneIndex.value++;
                if (currentSceneIndex.value >= currentChapter.value.scenes.length) {
                    if (currentChapterIndex.value === 4) {
                        showEnding();
                    } else {
                        gameState.value = 'chapterEnd';
                        chapterEndText.value = `ä½ æˆåŠŸé€šè¿‡äº†ç¬¬ ${currentChapterIndex.value} ç« çš„è€ƒéªŒï¼`;
                    }
                }
                saveGame();
            }, 2000);
        };
        
        // ä¸‹ä¸€ç« 
        const nextChapter = () => {
            currentChapterIndex.value++;
            currentSceneIndex.value = 0;
            player.value.hp = player.value.maxHp;
            player.value.mp = player.value.maxMp;
            stats.value.days += 7;
            gameState.value = 'story';
            saveGame();
        };
        
        // é€‰æ‹©è½¬ç”ŸèŒä¸š
        const selectRebirthJob = () => {
            gameState.value = 'selectJob';
        };
        
        // ç»“æŸç« èŠ‚
        const endChapter = () => {
            if (currentChapterIndex.value === 1) {
                currentChapterIndex.value = 2;
            } else if (currentChapterIndex.value === 3) {
                currentChapterIndex.value = 4;
            }
            currentSceneIndex.value = 0;
            player.value.hp = player.value.maxHp;
            player.value.mp = player.value.maxMp;
            stats.value.days += 14;
            gameState.value = 'story';
            saveGame();
        };
        
        // æ˜¾ç¤ºç»“å±€
        const showEnding = () => {
            let ending;
            if (player.value.intelligence >= 90) {
                ending = endings.good;
            } else if (player.value.emotion >= 90) {
                ending = endings.secret;
            } else if (player.value.tech >= 90) {
                ending = endings.neutral;
            } else {
                ending = endings.bad;
            }
            endingData.value = ending;
            gameState.value = 'ending';
        };
        
        // é‡æ–°å¼€å§‹
        const restartGame = () => {
            location.reload();
        };
        
        // åˆå§‹åŒ–
        onMounted(() => {
            setTimeout(() => {
                gameState.value = 'menu';
                const saveStr = localStorage.getItem('aiSurvivorSave');
                const settingsStr = localStorage.getItem('aiSurvivorSettings');
                if (saveStr) hasSave.value = true;
                if (settingsStr) {
                    settings.value = JSON.parse(settingsStr);
                }
            }, 2000);
        });
        
        return {
            gameState, showSettings, hasSave, settings,
            player, stats, jobs, selectedJob,
            currentChapter, currentScene, battle, sideQuestData,
            chapterEndText, endingData, toast, playerSkills,
            startGame, loadGame, saveSettings, resetGame,
            selectJob, confirmJob, makeChoice,
            completeSideQuest, skipSideQuest,
            startBossBattle, useSkill, nextChapter,
            selectRebirthJob, endChapter, showEnding, restartGame
        };
    }
}).mount('#app');
</script>
